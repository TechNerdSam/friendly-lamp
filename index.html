<!DOCTYPE html>
<html lang="fr" class="scroll-smooth antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Salam Check // Ultimate Protocol</title>
    
    <!-- ========================================== -->
    <!-- üíé PROTOCOLE FAVICON 2026 (TOP 1% DESIGN)  -->
    <!-- ========================================== -->
    <meta name="theme-color" content="#020204">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%232DD4BF' /%3E%3Cstop offset='100%25' stop-color='%236366f1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='25' fill='%230A0A0C' /%3E%3Cpath d='M28 53 L43 68 L73 35' stroke='url(%23grad)' stroke-width='8' fill='none' stroke-linecap='round' stroke-linejoin='round' /%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%232DD4BF' /%3E%3Cstop offset='100%25' stop-color='%236366f1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%230A0A0C' /%3E%3Cpath d='M28 53 L43 68 L73 35' stroke='url(%23grad)' stroke-width='8' fill='none' stroke-linecap='round' stroke-linejoin='round' /%3E%3C/svg%3E">
    <!-- ========================================== -->
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts: Plus Jakarta Sans (UI), Space Grotesk (Titres), JetBrains Mono (Code) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        background: '#020204',
                        surface: '#0A0A0C',
                        primary: '#2DD4BF',
                        accent: '#6366f1',
                    },
                    animation: {
                        'aurora': 'aurora 20s linear infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'reveal': 'reveal 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                    },
                    keyframes: {
                        aurora: {
                            '0%': { transform: 'translate(0, 0) rotate(0deg)' },
                            '100%': { transform: 'translate(10%, 10%) rotate(360deg)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        reveal: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- GLOBAL ESTHETICS --- */
        body {
            background-color: #020204;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Noise Texture (Grain photo) pour l'aspect premium */
        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 50;
            mix-blend-mode: overlay;
        }

        /* Aurora Background Gradients */
        .aurora-blob {
            position: absolute;
            filter: blur(80px);
            opacity: 0.4;
            animation: aurora 20s infinite alternate;
        }

        /* --- SPOTLIGHT CARD EFFECT --- */
        .spotlight-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        /* Ce pseudo-√©l√©ment suit la souris via JS */
        .spotlight-card::before {
            content: '';
            position: absolute;
            background: radial-gradient(
                800px circle at var(--mouse-x) var(--mouse-y),
                rgba(255, 255, 255, 0.06),
                transparent 40%
            );
            z-index: 3;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        
        .spotlight-card:hover::before {
            opacity: 1;
        }

        /* --- UI COMPONENTS --- */
        .glass-dock {
            background: rgba(10, 10, 12, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
        }

        .filter-chip {
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        .filter-chip.active {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(45, 212, 191, 0.1);
        }

        .status-badge {
            clip-path: polygon(10% 0, 100% 0, 100% 100%, 0% 100%, 0% 25%);
        }

        /* Loader */
        .loader-bar {
            background: linear-gradient(90deg, transparent, #2DD4BF, transparent);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body class="selection:bg-primary/30 selection:text-white">

    <!-- Texture Grain Overlay -->
    <div class="noise-overlay"></div>

    <!-- Ambient Background -->
    <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
        <div class="aurora-blob w-[500px] h-[500px] bg-primary/20 rounded-full top-[-10%] left-[-10%]"></div>
        <div class="aurora-blob w-[600px] h-[600px] bg-accent/10 rounded-full bottom-[-10%] right-[-10%] animation-delay-2000"></div>
    </div>

    <!-- Main Wrapper -->
    <div class="relative z-10 flex flex-col min-h-screen">
        
        <!-- Navbar -->
        <nav class="fixed top-0 w-full z-40 border-b border-white/5 bg-background/80 backdrop-blur-xl">
            <div class="max-w-[1400px] mx-auto px-6 h-16 flex items-center justify-between">
                <div class="flex items-center gap-3 group cursor-pointer">
                    <div class="relative w-8 h-8 flex items-center justify-center">
                        <div class="absolute inset-0 bg-primary/20 rounded-full blur-md group-hover:blur-lg transition-all"></div>
                        <div class="relative w-2 h-2 bg-primary rounded-full animate-pulse"></div>
                    </div>
                    <span class="font-display font-bold text-xl tracking-tight text-white group-hover:text-primary transition-colors">SALAM<span class="opacity-50 font-light">CHECK</span></span>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/5 text-[10px] font-mono text-gray-400">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                        LIVE FEED // API V2
                    </div>
                    <button onclick="fetchAndUpdateProducts()" class="p-2 rounded-full hover:bg-white/10 transition-colors text-white">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <main class="flex-grow pt-24 pb-40 px-4 md:px-6 max-w-[1400px] mx-auto w-full">
            
            <!-- Hero / Header -->
            <header class="mb-16 md:mb-24 flex flex-col md:flex-row justify-between items-end gap-8 opacity-0 animate-reveal">
                <div>
                    <div class="inline-flex items-center gap-2 mb-4">
                        <span class="h-px w-8 bg-primary/50"></span>
                        <span class="text-xs font-mono text-primary tracking-[0.2em] uppercase">Algorithm v2.5</span>
                    </div>
                    <h1 class="text-5xl md:text-8xl font-display font-medium text-white leading-[0.9] tracking-tighter mb-6">
                        Purity <span class="text-gray-600">is</span><br/>
                        <span class="italic font-serif text-primary/90">Priority.</span>
                    </h1>
                    <p class="text-gray-400 max-w-lg text-lg font-light leading-relaxed">
                        Le moteur d'analyse s√©mantique le plus avanc√© pour la d√©tection temps r√©el d'additifs et d'ingr√©dients.
                    </p>
                </div>
                
                <div class="hidden md:block text-right">
                    <div class="text-xs font-mono text-gray-500 mb-1">PRODUITS ANALYS√âS (24H)</div>
                    <div class="text-4xl font-display font-bold text-white tabular-nums">14,209</div>
                </div>
            </header>

            <!-- Floating Dock / Controls (Centered & Sticky) -->
            <div class="sticky top-20 z-30 flex justify-center mb-12 opacity-0 animate-reveal" style="animation-delay: 0.2s;">
                <div class="glass-dock p-1.5 rounded-2xl flex items-center gap-1 shadow-2xl scale-95 hover:scale-100 transition-transform duration-300">
                    <div id="filterButtons" class="flex gap-1">
                        <button data-status="all" class="filter-chip active relative px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white border border-transparent">
                            Global
                        </button>
                        <button data-status="Halal" class="filter-chip relative px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white border border-transparent flex items-center gap-2 group">
                            <span class="w-1.5 h-1.5 rounded-full bg-teal-500 group-hover:shadow-[0_0_8px_#2DD4BF] transition-shadow"></span>
                            Halal
                        </button>
                        <button data-status="Haram" class="filter-chip relative px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white border border-transparent flex items-center gap-2 group">
                            <span class="w-1.5 h-1.5 rounded-full bg-rose-500 group-hover:shadow-[0_0_8px_#F43F5E] transition-shadow"></span>
                            Haram
                        </button>
                        <button data-status="Douteux" class="filter-chip relative px-5 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:text-white border border-transparent flex items-center gap-2 group">
                            <span class="w-1.5 h-1.5 rounded-full bg-amber-500 group-hover:shadow-[0_0_8px_#F59E0B] transition-shadow"></span>
                            Check
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Grid -->
            <div id="productList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 auto-rows-fr opacity-0 animate-reveal" style="animation-delay: 0.4s;">
                <!-- Cards Injected Here -->
            </div>

            <!-- Empty State -->
            <div id="noResults" class="hidden flex flex-col items-center justify-center py-32 text-center opacity-0 animate-reveal">
                <div class="w-20 h-20 mb-6 rounded-full bg-white/5 flex items-center justify-center border border-white/5">
                    <span class="text-3xl text-gray-600">‚àÖ</span>
                </div>
                <h3 class="text-2xl font-display font-medium text-white mb-2">Signal Perdu</h3>
                <p class="text-gray-500 font-mono text-sm">Aucune donn√©e ne correspond aux param√®tres actuels.</p>
            </div>

        </main>
        
        <!-- Footer -->
        <footer class="border-t border-white/5 py-12 px-6">
            <div class="max-w-[1400px] mx-auto flex flex-col md:flex-row justify-between items-center gap-6 opacity-50 hover:opacity-100 transition-opacity">
                <p class="text-xs font-mono text-gray-500">SALAM CHECK SYSTEMS ¬© 2026</p>
                <div class="flex gap-6 text-xs font-mono text-gray-500 uppercase tracking-wider">
                    <a href="#" class="hover:text-primary transition-colors">Privacy</a>
                    <a href="#" class="hover:text-primary transition-colors">Data</a>
                    <a href="#" class="hover:text-primary transition-colors">Manifesto</a>
                </div>
            </div>
        </footer>

    </div>

    <!-- Logic -->
    <script>
        // --- CONSTANTS & CONFIG ---
        const CONFIG = {
            apiEndpoint: "https://world.openfoodfacts.org/api/v2/search",
            refreshInterval: 60000,
            requiredFields: "product_name,code,image_url,image_small_url,ingredients_text_fr,labels,categories,additives_tags,ingredients_analysis_tags,brands",
            haramKeywords: ['porc', 'saindoux', 'g√©latine de porc', 'lardons', 'jambon', 'bacon', 'vin', 'alcool', 'bi√®re', 'liqueur', '√©thanol', 'cochon', 'g√©latine animale', 'cochenille', 'e120', 'rhum', 'whisky', 'vodka', 'gin'],
            doubtfulKeywords: ['g√©latine', 'pr√©sure', 'e471', 'e472', 'mono et diglyc√©rides', 'graisses animales', 'collag√®ne', 'lactos√©rum', 'ar√¥me'],
            safeKeywords: ['g√©latine v√©g√©tale', 'g√©latine de poisson', 'pectine', 'agar-agar']
        };

        // --- STATE ---
        let state = {
            products: [],
            filter: 'all',
            loading: true
        };

        // --- DOM ---
        const els = {
            grid: document.getElementById('productList'),
            noResults: document.getElementById('noResults'),
            filters: document.getElementById('filterButtons')
        };

        // --- ANALYTICS ENGINE ---
        const analyzeProduct = (product) => {
            const ingredients = (product.ingredients_text_fr || "").toLowerCase();
            const labels = (product.labels || "").toLowerCase();
            const name = (product.product_name || "").toLowerCase();
            const cats = (product.categories || "").toLowerCase();
            const additives = (product.additives_tags || []).join(' ').toLowerCase();

            if (labels.includes('halal')) return { status: 'Halal', reason: 'Certifi√© Halal', score: 100 };

            if (CONFIG.haramKeywords.some(k => name.includes(k) || cats.includes(k))) {
                const match = CONFIG.haramKeywords.find(k => name.includes(k) || cats.includes(k));
                return { status: 'Haram', reason: `Contient: ${match}`, score: 0 };
            }

            if (additives.includes('e120')) return { status: 'Haram', reason: 'E120 (Cochenille)', score: 10 };

            for (const word of CONFIG.haramKeywords) {
                if (ingredients.includes(word)) return { status: 'Haram', reason: `Ingr√©dient: ${word}`, score: 5 };
            }

            for (const word of CONFIG.doubtfulKeywords) {
                if (ingredients.includes(word) && !CONFIG.safeKeywords.some(safe => ingredients.includes(safe))) {
                    return { status: 'Douteux', reason: `V√©rifier: ${word}`, score: 40 };
                }
            }

            if (cats.includes('eaux') || (cats.includes('fruits') && !cats.includes('sirop')) || cats.includes('l√©gumes frais')) {
                return { status: 'Halal', reason: 'Naturel', score: 95 };
            }

            if ((product.ingredients_analysis_tags || []).includes('en:vegan')) {
                 return { status: 'Halal', reason: 'Vegan', score: 90 };
            }

            if (!ingredients) return { status: 'Douteux', reason: 'Donn√©es manquantes', score: 20 };

            return { status: 'Douteux', reason: 'Non certifi√©', score: 50 };
        };

        // --- UI GENERATORS ---
        const getStyles = (status) => {
            const map = {
                'Halal': { 
                    border: 'border-teal-500/20', bg: 'bg-teal-500/5', text: 'text-teal-400', 
                    label: 'HALAL VERIFIED', glow: 'shadow-teal-900/20' 
                },
                'Haram': { 
                    border: 'border-rose-500/20', bg: 'bg-rose-500/5', text: 'text-rose-400', 
                    label: 'HARAM DETECTED', glow: 'shadow-rose-900/20' 
                },
                'Douteux': { 
                    border: 'border-amber-500/20', bg: 'bg-amber-500/5', text: 'text-amber-400', 
                    label: 'MANUAL CHECK', glow: 'shadow-amber-900/20' 
                }
            };
            return map[status] || map['Douteux'];
        };

        const createSkeleton = () => `
            <div class="glass-dock h-[380px] rounded-2xl p-4 flex flex-col gap-4 animate-pulse">
                <div class="h-48 rounded-xl bg-white/5 w-full"></div>
                <div class="h-6 w-2/3 bg-white/5 rounded"></div>
                <div class="h-4 w-1/2 bg-white/5 rounded"></div>
                <div class="mt-auto h-10 w-full bg-white/5 rounded-xl"></div>
            </div>
        `;

        const createCard = (product, analysis) => {
            const style = getStyles(analysis.status);
            const img = product.image_url || 'https://via.placeholder.com/400';
            
            return `
            <div class="spotlight-card group rounded-2xl bg-[#0A0A0C] hover:bg-[#121214] transition-colors duration-500 flex flex-col h-full cursor-default">
                
                <!-- Image Container -->
                <div class="relative h-56 overflow-hidden rounded-t-2xl bg-[#050505]">
                    <img src="${img}" alt="${product.product_name}" loading="lazy" 
                         class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-700 ease-out grayscale-[30%] group-hover:grayscale-0">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-[#0A0A0C] via-transparent to-transparent"></div>
                    
                    <div class="absolute top-4 right-4">
                        <span class="px-2 py-1 rounded bg-black/60 backdrop-blur border border-white/10 text-[10px] font-mono text-white/70">
                            ${analysis.score}% SAFETY
                        </span>
                    </div>
                </div>

                <!-- Content -->
                <div class="p-5 flex flex-col flex-grow relative z-10">
                    
                    <!-- Title -->
                    <h2 class="text-lg font-display font-medium text-white mb-1 line-clamp-2 leading-tight group-hover:text-white/90 transition-colors">
                        ${product.product_name}
                    </h2>
                    <p class="text-xs font-mono text-gray-500 uppercase tracking-wide mb-6">
                        ${(product.brands || "Unknown Brand").split(',')[0]}
                    </p>

                    <!-- Status Indicator -->
                    <div class="mt-auto">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-[10px] font-mono text-gray-500 uppercase tracking-widest">DIAGNOSTIC</span>
                            <span class="text-xs font-bold font-sans ${style.text} tracking-wide">${style.label}</span>
                        </div>
                        
                        <!-- Analysis Box -->
                        <div class="p-3 rounded-lg border ${style.border} ${style.bg} relative overflow-hidden group/box">
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent translate-x-[-100%] group-hover/box:translate-x-[100%] transition-transform duration-1000"></div>
                            <p class="text-xs text-gray-300 relative z-10">
                                <span class="${style.text} mr-1">‚óè</span> ${analysis.reason}
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Full Link Overlay -->
                <a href="https://world.openfoodfacts.org/product/${product.code}" target="_blank" class="absolute inset-0 z-20"></a>
            </div>
            `;
        };

        // --- SPOTLIGHT EFFECT LOGIC ---
        const initSpotlight = () => {
            els.grid.onmousemove = e => {
                for(const card of document.getElementsByClassName("spotlight-card")) {
                    const rect = card.getBoundingClientRect(),
                          x = e.clientX - rect.left,
                          y = e.clientY - rect.top;
                    card.style.setProperty("--mouse-x", `${x}px`);
                    card.style.setProperty("--mouse-y", `${y}px`);
                }
            };
        };

        // --- FETCH & RENDER ---
        const fetchAndUpdateProducts = async () => {
            state.loading = true;
            render(); // Show skeletons

            try {
                const url = `${CONFIG.apiEndpoint}?sort_by=last_modified_t&page_size=60&fields=${CONFIG.requiredFields}&json=1&countries_tags_fr=france`;
                const response = await fetch(url);
                const data = await response.json();
                state.products = data.products.filter(p => p.product_name && (p.image_url || p.image_small_url));
                state.loading = false;
                render();
            } catch (error) {
                console.error("API Failure", error);
                state.loading = false;
                // Retry silently
            }
        };

        const render = () => {
            if (state.loading) {
                els.grid.innerHTML = Array(8).fill(createSkeleton()).join('');
                return;
            }

            const filtered = state.filter === 'all' 
                ? state.products 
                : state.products.filter(p => analyzeProduct(p).status === state.filter);

            if (filtered.length === 0) {
                els.grid.innerHTML = '';
                els.noResults.classList.remove('hidden');
                return;
            }

            els.noResults.classList.add('hidden');
            els.grid.innerHTML = filtered.map(p => createCard(p, analyzeProduct(p))).join('');
            
            // Re-init spotlight for new elements
            requestAnimationFrame(initSpotlight);
        };

        // --- EVENTS ---
        els.filters.addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;
            
            document.querySelectorAll('.filter-chip').forEach(b => {
                b.classList.remove('active', 'text-white', 'bg-white/10', 'border-white/20', 'shadow-lg');
                b.classList.add('text-gray-400', 'border-transparent');
            });
            
            btn.classList.add('active', 'text-white');
            btn.classList.remove('text-gray-400', 'border-transparent');
            
            state.filter = btn.dataset.status;
            render();
        });

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndUpdateProducts();
            setInterval(fetchAndUpdateProducts, 60000);
        });

    </script>
</body>
</html>
